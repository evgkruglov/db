## 1. Что такое Kubernetes?

**Kubernetes (K8s)** — это система оркестрации контейнеров, которая:
- Абстрагирует инфраструктуру и предоставляет доступ ко всему ЦОД как к одному вычислительному ресурсу.
- Управляет развертыванием, масштабированием и доступностью контейнеризованных приложений.
- Позволяет разработчикам фокусироваться на коде, не заботясь об аппаратной инфраструктуре (**NoOps**).
- Сисадмины управляют кластерами, не вникая в детали конкретных приложений.

## 2. Почему Kubernetes?

- **Масштабируемость**: автоматически увеличивает или уменьшает количество подов в зависимости от нагрузки.
- **Отказоустойчивость**: при сбое узла контейнеры автоматически переносятся на доступные узлы.
- **Автоматизация**: автоматический перезапуск контейнеров, замена, балансировка нагрузки.
- **Изоляция**: благодаря контейнеризации приложения не зависят от хост-системы.
- **Быстрое развертывание**: разработчики могут выкатывать приложения без знания инфраструктуры.

## 3. Контейнеризация и Linux-примитивы

В основе Kubernetes лежит контейнеризация — изолированные процессы, которые считают, что работают в собственной системе.

Контейнер:
- Думает, что он единственный в системе.
- Использует только назначенные ресурсы.
- Не "видит" другие процессы за пределами контейнера.

Контейнеризация в Linux построена на:
1. **Namespaces (пространства имён)** → изоляция окружения (процессы, сеть, файловая система, IPC).
2. **cgroups (контрольные группы)** → ограничение ресурсов (CPU, память, сеть, I/O).

## 4. Kubernetes vs Виртуализация

Контейнер ≠ Виртуальная машина:
- Контейнер использует ядро хоста, а не своё.
- Docker-образ можно запустить на любой Linux-системе **с тем же ядром**.
- Нельзя запускать контейнер для **x86** на **ARM**, несмотря на поддержку Docker.

## 5. Архитектура Kubernetes

Кластер Kubernetes состоит из:
- **Control Plane (управляющая плоскость)** — управляет кластером.
- **Worker Nodes (рабочие узлы)** — выполняют контейнеры.

### Control Plane (управляющая плоскость)

Отвечает за управление состоянием кластера.

- **API Server** — главный компонент, принимает команды (`kubectl`), обрабатывает запросы.
- **Scheduler (планировщик)** — распределяет поды по рабочим узлам.
- **Controller Manager** — управляет состоянием объектов (поды, сервисы).
- **etcd** — распределённое хранилище конфигурации кластера.

### Worker Nodes (рабочие узлы)

- **Container Runtime (Docker, CRI-O, containerd)** — исполняет контейнеры.
- **Kubelet** — агент, взаимодействующий с Control Plane, управляет жизненным циклом подов.
- **kube-proxy** — балансировка сетевого трафика между подами.

## 6. Как работает развертывание в Kubernetes

Чтобы развернуть приложение в Kubernetes:
1. Упаковать приложение в контейнер.
2. Опубликовать контейнер в **Docker Registry**.
3. Создать **манифест (YAML)**, описывающий:
   - Какое приложение запускать.
   - Сколько подов создать.
   - Какие ресурсы запросить.
4. Применить манифест:
   ```bash
   kubectl apply -f deployment.yaml
   ```
5. **API Server** обрабатывает запрос.
6. **Scheduler** назначает под на доступный узел.
7. **Kubelet** запускает контейнер.
8. **kube-proxy** обеспечивает сетевую доступность.

## 7. Основные Kubernetes-объекты

1. **Pod** → минимальная единица развертывания (может содержать несколько контейнеров).
2. **Deployment** → управляет репликацией и обновлениями подов.
3. **Service** → обеспечивает доступ к подам, балансирует трафик.
4. **ConfigMap** → хранит неконфиденциальные данные (переменные среды, конфиги).
5. **Secret** → хранит чувствительные данные (пароли, токены).

## 8. Сетевое взаимодействие в Kubernetes

Kubernetes использует **CNI (Container Network Interface)**. Основные решения:
- **Flannel** — простая L3-сеть.
- **Calico** — поддержка сетевых политик.
- **Cilium** — eBPF-сетевой стек.
- **Istio / Linkerd** — сервис-меши.

## 9. Масштабирование и отказоустойчивость

- **Horizontal Pod Autoscaler (HPA)** → Авто-масштабирование подов по CPU/RAM.
- **Node Autoscaler** → Авто-масштабирование узлов при нехватке ресурсов.

## 10. Основные команды Kubernetes

### Работа с подами
```bash
kubectl get pods                         # Список подов
kubectl describe pod <pod-name>          # Информация о поде
kubectl logs <pod-name>                  # Логи контейнера
kubectl exec -it <pod-name> -- bash      # Вход в контейнер
```

### Развертывание
```bash
kubectl apply -f <file>.yaml             # Применить манифест
kubectl delete -f <file>.yaml            # Удалить манифест
```

### Мониторинг и отладка
```bash
kubectl top pod                          # Использование CPU и RAM
kubectl events                           # События в кластере
```

## Вывод

1. Kubernetes — мощная платформа оркестрации контейнеров.
2. В основе: **Control Plane (управление)** и **Worker Nodes (исполнение)**.
3. Использует Linux namespaces для изоляции и cgroups для контроля ресурсов.
4. Основные объекты: **Pods**, **Services**, **Deployments**, **ConfigMaps**, **Secrets**.
5. Автономность и отказоустойчивость: автоматический перезапуск, масштабирование.
6. Возможность работы с сетями, балансировка, сервис-меши.